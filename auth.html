<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Чат-комнаты</title>
    <style>
        /* Стили остаются такими же, как в предыдущем примере */
    </style>
</head>
<body>
    <!-- HTML структура остается такой же, как в предыдущем примере -->
    
    <script>
        // Проверка авторизации пользователя
        function checkAuth() {
            const user = localStorage.getItem('currentUser');
            if (user) {
                const userData = JSON.parse(user);
                document.getElementById('auth-buttons').classList.add('hidden');
                document.getElementById('user-info').classList.remove('hidden');
                document.getElementById('username-display').textContent = userData.username;
                document.getElementById('user-avatar').textContent = userData.username.charAt(0).toUpperCase();
                document.getElementById('auth-required').classList.add('hidden');
                document.getElementById('chat-section').classList.remove('hidden');
                document.getElementById('chat-link').classList.remove('hidden');
            } else {
                document.getElementById('auth-buttons').classList.remove('hidden');
                document.getElementById('user-info').classList.add('hidden');
                document.getElementById('auth-required').classList.remove('hidden');
                document.getElementById('chat-section').classList.add('hidden');
                document.getElementById('chat-link').classList.add('hidden');
            }
        }

        // Выход из системы
        document.getElementById('logout-btn').addEventListener('click', function() {
            localStorage.removeItem('currentUser');
            checkAuth();
        });

        // Отправка сообщения
        document.getElementById('send-message').addEventListener('click', function() {
            const messageInput = document.getElementById('message-input');
            const message = messageInput.value.trim();
            
            if (message) {
                const user = JSON.parse(localStorage.getItem('currentUser'));
                const messagesContainer = document.getElementById('chat-messages');
                
                const now = new Date();
                const dateStr = `${now.getDate().toString().padStart(2, '0')}.${(now.getMonth()+1).toString().padStart(2, '0')}.${now.getFullYear()}`;
                const timeStr = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
                
                const messageElement = document.createElement('div');
                messageElement.className = 'message';
                messageElement.innerHTML = `
                    <div class="message-header">
                        <span class="message-user">${user.username}</span>
                        <span class="message-time">${dateStr} ${timeStr}</span>
                    </div>
                    <div class="message-content">${message}</div>
                `;
                
                messagesContainer.appendChild(messageElement);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                messageInput.value = '';
            }
        });

        // Отправка сообщения по нажатию Enter
        document.getElementById('message-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('send-message').click();
            }
        });

        // Проверка авторизации при загрузке страницы
        document.addEventListener('DOMContentLoaded', checkAuth);
    </script>
</body>
</html>
